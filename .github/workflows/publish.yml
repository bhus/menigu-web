name: Publish scheduled posts
on:
  schedule:
    - cron: "0 12 * * *"  # every day at noon UTC, publish posts in _drafts with a date prefix like 2025-11-19-my-post.md
  workflow_dispatch:

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Publish posts with date â‰¤ today
        run: |
          for f in _drafts/*.md; do
            [ -e "$f" ] || continue
            filename=$(basename "$f")
            post_date=${filename:0:10}
            if [[ "$post_date" < "$(date +%Y-%m-%d)" || "$post_date" == "$(date +%Y-%m-%d)" ]]; then
              mv "$f" "_posts/$filename"
            fi
          done
      - name: Commit and push if changes
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add .
          git diff --cached --quiet || git commit -m "Auto-publish scheduled posts"
          git push
